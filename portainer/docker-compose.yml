version: '3'

services:
  portainer:
    image: portainer/portainer
    deploy:
      mode: replicated
      placement:
        constraints:
          - node.role==manager
      replicas: 1
      restart_policy:
        condition: any
        delay: 5s
        max_attempts: 3
        window: 120s
    restart: always
    ports:
      - "9000:9000"
    networks:
      - functions
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - "/mnt/ssd/projects/private-hosting/portainer/data:/data"
    container_name: portainer # not supported in swarm mode

networks:
  functions:
    external: true
